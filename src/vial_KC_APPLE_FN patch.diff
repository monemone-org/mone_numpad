From bd1e1c9fa4b848ef92fd9fab6c5631c3f0589856 Mon Sep 17 00:00:00 2001
From: monehsieh <monehsieh@gmail.com>
Date: Sat, 19 Mar 2022 00:45:04 -0700
Subject: [PATCH] added vial support

---
 keyboards/monenumpad/config.h                 | 28 ++++--
 keyboards/monenumpad/keymaps/via/rules.mk     |  1 -
 .../monenumpad/keymaps/{via => vial}/keymap.c | 22 ++++-
 keyboards/monenumpad/keymaps/vial/rules.mk    |  8 ++
 keyboards/monenumpad/keymaps/vial/vial.json   | 99 +++++++++++++++++++
 keyboards/monenumpad/readme.md                | 20 +++-
 keyboards/monenumpad/rules.mk                 |  7 ++
 7 files changed, 168 insertions(+), 17 deletions(-)
 delete mode 100644 keyboards/monenumpad/keymaps/via/rules.mk
 rename keyboards/monenumpad/keymaps/{via => vial}/keymap.c (79%)
 create mode 100644 keyboards/monenumpad/keymaps/vial/rules.mk
 create mode 100644 keyboards/monenumpad/keymaps/vial/vial.json

diff --git a/keyboards/monenumpad/config.h b/keyboards/monenumpad/config.h
index 7534f5126f..0385c26bba 100644
--- a/keyboards/monenumpad/config.h
+++ b/keyboards/monenumpad/config.h
@@ -14,7 +14,7 @@
  */
 #define VENDOR_ID    0x6D68      // "mh" = monehsieh
 #define PRODUCT_ID   0x0001
-#define DEVICE_VER   0x0001
+#define DEVICE_VER   0x0002      // version 2: vial
 #define MANUFACTURER monehsieh
 #define PRODUCT      monenumpad
 
@@ -45,12 +45,6 @@
 #define ENCODERS_PAD_B { B2 }
 #define ENCODER_RESOLUTION 4
 
-
-#define BOOTMAGIC_LITE_ROW 4
-#define BOOTMAGIC_LITE_COLUMN 0
-
-
-
 /*
  * Split Keyboard specific options, make sure you have 'SPLIT_KEYBOARD = yes' in your rules.mk, and define SOFT_SERIAL_PIN.
  */
@@ -152,5 +146,21 @@
 #define NO_ACTION_FUNCTION
 
 /* Bootmagic Lite key configuration */
-//#define BOOTMAGIC_LITE_ROW 0
-//#define BOOTMAGIC_LITE_COLUMN 0
+#define BOOTMAGIC_LITE_ROW 4
+#define BOOTMAGIC_LITE_COLUMN 0
+
+
+#define VIAL_KEYBOARD_UID {0xE1, 0x03, 0xDC, 0xC8, 0xB3, 0x98, 0x04, 0x18}
+// top 2 keys of right most column
+#define VIAL_UNLOCK_COMBO_ROWS {0,1}
+#define VIAL_UNLOCK_COMBO_COLS {4,4}
+
+#define VIAL_ENCODER_DEFAULT { KC_VOLD, KC_VOLU, KC_BRID, KC_BRIU, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS }
+
+
+
+
+
+
+
+
diff --git a/keyboards/monenumpad/keymaps/via/rules.mk b/keyboards/monenumpad/keymaps/via/rules.mk
deleted file mode 100644
index 1e5b99807c..0000000000
--- a/keyboards/monenumpad/keymaps/via/rules.mk
+++ /dev/null
@@ -1 +0,0 @@
-VIA_ENABLE = yes
diff --git a/keyboards/monenumpad/keymaps/via/keymap.c b/keyboards/monenumpad/keymaps/vial/keymap.c
similarity index 79%
rename from keyboards/monenumpad/keymaps/via/keymap.c
rename to keyboards/monenumpad/keymaps/vial/keymap.c
index 13bff92e00..a0cfb776d1 100644
--- a/keyboards/monenumpad/keymaps/via/keymap.c
+++ b/keyboards/monenumpad/keymaps/vial/keymap.c
@@ -6,7 +6,9 @@
 // Defines names for use in layer keycodes and the keymap
 enum layer_names {
     _BASE,
-    _FN
+    _FN1,
+    _FN2,
+    _FN3
 };
 
 /*
@@ -29,12 +31,28 @@ const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
 KC_MUTE, KC_P1,  KC_P2,   KC_P3, 
 KC_BSPACE,    KC_P0   ,   KC_DOT,  KC_PENT),
 
-    [_FN] = LAYOUT(
+    [_FN1] = LAYOUT(
+          _______, _______, _______, _______, 
+          _______, _______, _______, _______, 
+          _______, _______, _______, _______, 
+ _______, _______, _______, _______,  
+ _______,     _______     , _______, _______),
+
+
+    [_FN2] = LAYOUT(
+          _______, _______, _______, _______, 
+          _______, _______, _______, _______, 
+          _______, _______, _______, _______, 
+ _______, _______, _______, _______,  
+ _______,     _______     , _______, _______),
+
+    [_FN3] = LAYOUT(
           _______, _______, _______, _______, 
           _______, _______, _______, _______, 
           _______, _______, _______, _______, 
  _______, _______, _______, _______,  
  _______,     _______     , _______, _______)
+
 };
 
 
diff --git a/keyboards/monenumpad/keymaps/vial/rules.mk b/keyboards/monenumpad/keymaps/vial/rules.mk
new file mode 100644
index 0000000000..83e6e1d80c
--- /dev/null
+++ b/keyboards/monenumpad/keymaps/vial/rules.mk
@@ -0,0 +1,8 @@
+VIA_ENABLE = yes
+VIAL_ENABLE = yes
+VIAL_ENCODERS_ENABLE = yes
+
+# LTO makes the compiler work harder when optimizing your code, resulting in a smaller firmware size
+#LTO_ENABLE = yes
+
+QMK_SETTINGS = no
diff --git a/keyboards/monenumpad/keymaps/vial/vial.json b/keyboards/monenumpad/keymaps/vial/vial.json
new file mode 100644
index 0000000000..44fc43560b
--- /dev/null
+++ b/keyboards/monenumpad/keymaps/vial/vial.json
@@ -0,0 +1,99 @@
+{
+    "name": "monenumpad",
+    "vendorId": "0x6D68",
+    "productId": "0x0001",
+    "lighting": "none",
+    "matrix": {
+        "rows": 5,
+        "cols": 5
+    },
+    "layouts": {
+        "keymap": [
+
+  [
+    {
+      "x": 1.75
+    },
+    "0,1",
+    "0,2",
+    "0,3",
+    {
+      "x": -0.5,
+      "a": 7,
+      "f": 4,
+      "w": 14,
+      "h": 5,
+      "d": true
+    },
+    "",
+    {
+      "x": -13.5,
+      "a": 4,
+      "f": 3
+    },
+    "0,4"
+  ],
+  [
+    {
+      "x": 1.75
+    },
+    "1,1",
+    "1,2",
+    "1,3",
+    "1,4"
+  ],
+  [
+    {
+      "x": 1.75
+    },
+    "2,1",
+    "2,2",
+    "2,3",
+    "2,4"
+  ],
+  [
+    "3,0",
+    {
+      "f": 2,
+      "w": 0.75,
+      "h": 0.75
+    },
+    "0,0\n\n\n\n\n\n\n\n\ne",
+    {
+      "f": 3
+    },
+    "3,1",
+    "3,2",
+    "3,3",
+    {
+      "h": 2
+    },
+    "4,4"
+  ],
+  [
+    {
+      "y": -0.25,
+      "x": 1,
+      "f": 2,
+      "w": 0.75,
+      "h": 0.75
+    },
+    "0,1\n\n\n\n\n\n\n\n\ne"
+  ],
+  [
+    {
+      "y": -0.75,
+      "f": 3
+    },
+    "4,0",
+    {
+      "x": 0.75,
+      "w": 2
+    },
+    "4,2",
+    "4,3"
+  ]
+
+        ]
+    }
+}
diff --git a/keyboards/monenumpad/readme.md b/keyboards/monenumpad/readme.md
index a4156801ef..84afe81a56 100644
--- a/keyboards/monenumpad/readme.md
+++ b/keyboards/monenumpad/readme.md
@@ -8,20 +8,30 @@
 * Hardware Supported: *The PCBs, controllers supported*
 * Hardware Availability: *Links to where you can find this hardware*
 
+Install qmk
+
+    git clone https://github.com/vial-kb/vial-qmk.git
+
 Make example for this keyboard (after setting up your build environment):
 
-    make monenumpad:default
+    make monenumpad:vial
 
 Flashing example for this keyboard:
 
-    make monenumpad:default:flash
+    make monenumpad:vial:flash
 
 See the [build environment setup](https://docs.qmk.fm/#/getting_started_build_tools) and the [make instructions](https://docs.qmk.fm/#/getting_started_make_guide) for more information. Brand new to QMK? Start with our [Complete Newbs Guide](https://docs.qmk.fm/#/newbs).
 
+
+See [VIAL Porting Build](https://get.vial.today/docs/)
+
+
 ## Bootloader
 
-Enter the bootloader in 3 ways:
+Enter the bootloader in one of the following ways:
 
-* **Bootmagic reset**: Hold down the key at (0,0) in the matrix (usually the top left key or Escape) and plug in the keyboard
 * **Physical reset button**: Briefly press the button on the back of the PCB - some may have pads you must short instead
-* **Keycode in layout**: Press the key mapped to `RESET` if it is available
+* **Ground reset pin**: Short GND and RESET pin on the micro controller
+
+
+
diff --git a/keyboards/monenumpad/rules.mk b/keyboards/monenumpad/rules.mk
index 3138e4cd11..1c7011c38e 100644
--- a/keyboards/monenumpad/rules.mk
+++ b/keyboards/monenumpad/rules.mk
@@ -18,3 +18,10 @@ RGBLIGHT_ENABLE = no        # Enable keyboard RGB underglow
 AUDIO_ENABLE = no           # Audio output
 
 ENCODER_ENABLE = yes
+
+
+VIA_ENABLE = yes
+VIAL_ENABLE = yes
+VIAL_ENCODERS_ENABLE = yes
+
+
-- 
2.31.0

From 1f833169d58699a7b646780c4d1bfefd52a03692 Mon Sep 17 00:00:00 2001
From: monehsieh <monehsieh@gmail.com>
Date: Wed, 23 Mar 2022 11:51:31 -0700
Subject: [PATCH] merged KC_APPLE_FN changes too support Apple Fn key

source:
https://gist.github.com/fauxpark/010dcf5d6377c3a71ac98ce37414c6c4
---
 keyboards/monenumpad                          |   1 +
 keyboards/monenumpad/config.h                 | 166 ------------------
 keyboards/monenumpad/info.json                |  29 ---
 keyboards/monenumpad/keymaps/default/keymap.c |  84 ---------
 keyboards/monenumpad/keymaps/vial/keymap.c    | 102 -----------
 keyboards/monenumpad/keymaps/vial/rules.mk    |   8 -
 keyboards/monenumpad/keymaps/vial/vial.json   |  99 -----------
 keyboards/monenumpad/monenumpad.c             |   4 -
 keyboards/monenumpad/monenumpad.h             |  55 ------
 keyboards/monenumpad/monenumpad.json          |  60 -------
 keyboards/monenumpad/readme.md                |  37 ----
 keyboards/monenumpad/rules.mk                 |  27 ---
 quantum/action.c                              |  27 +++
 quantum/action_code.h                         |   6 +
 quantum/keycode.h                             |   9 +-
 quantum/keymap_common.c                       |   5 +
 tmk_core/protocol/report.c                    |  12 ++
 tmk_core/protocol/usb_descriptor.c            |  10 ++
 tmk_core/protocol/vusb/vusb.c                 |  11 +-
 19 files changed, 79 insertions(+), 673 deletions(-)
 create mode 120000 keyboards/monenumpad
 delete mode 100644 keyboards/monenumpad/config.h
 delete mode 100644 keyboards/monenumpad/info.json
 delete mode 100644 keyboards/monenumpad/keymaps/default/keymap.c
 delete mode 100644 keyboards/monenumpad/keymaps/vial/keymap.c
 delete mode 100644 keyboards/monenumpad/keymaps/vial/rules.mk
 delete mode 100644 keyboards/monenumpad/keymaps/vial/vial.json
 delete mode 100644 keyboards/monenumpad/monenumpad.c
 delete mode 100644 keyboards/monenumpad/monenumpad.h
 delete mode 100644 keyboards/monenumpad/monenumpad.json
 delete mode 100644 keyboards/monenumpad/readme.md
 delete mode 100644 keyboards/monenumpad/rules.mk

diff --git a/keyboards/monenumpad b/keyboards/monenumpad
new file mode 120000
index 0000000000..57589d1256
--- /dev/null
+++ b/keyboards/monenumpad
@@ -0,0 +1 @@
+../../mone_numpad/src/qmk-firmware-keyboard/monenumpad
\ No newline at end of file
diff --git a/keyboards/monenumpad/config.h b/keyboards/monenumpad/config.h
deleted file mode 100644
index 0385c26bba..0000000000
--- a/keyboards/monenumpad/config.h
+++ /dev/null
@@ -1,166 +0,0 @@
-// Copyright 2022 monehsieh (@monehsieh)
-// SPDX-License-Identifier: GPL-2.0-or-later
-
-#pragma once
-
-#include "config_common.h"
-
-/**
- * A suggested method of choosing a unique VENDOR_ID is choosing two letters from the keyboardâ€™s
- *  designer/vendor name and using the two 8-bit ASCII values of these letters
- * 
- *  Designer: monehsieh
- *  ASCII for "mh": 0x6D 0x68
- */
-#define VENDOR_ID    0x6D68      // "mh" = monehsieh
-#define PRODUCT_ID   0x0001
-#define DEVICE_VER   0x0002      // version 2: vial
-#define MANUFACTURER monehsieh
-#define PRODUCT      monenumpad
-
-/* key matrix size */
-#define MATRIX_ROWS 5
-#define MATRIX_COLS 5
-
-/*
- * Keyboard Matrix Assignments
- *
- * Change this to how you wired your keyboard
- * COLS: AVR pins used for columns, left to right
- * ROWS: AVR pins used for rows, top to bottom
- * DIODE_DIRECTION: COL2ROW = COL = Anode (+), ROW = Cathode (-, marked on diode)
- *                  ROW2COL = ROW = Anode (+), COL = Cathode (-, marked on diode)
- *
- */
-
-#define MATRIX_ROW_PINS { D4, E6, B5, F7, F6 }
-#define MATRIX_COL_PINS { B3, B1, B4, D7, C6 }
-#define UNUSED_PINS
-
-/* COL2ROW or ROW2COL */
-//#define DIODE_DIRECTION COL2ROW
-#define DIODE_DIRECTION ROW2COL
-
-#define ENCODERS_PAD_A { B6 }
-#define ENCODERS_PAD_B { B2 }
-#define ENCODER_RESOLUTION 4
-
-/*
- * Split Keyboard specific options, make sure you have 'SPLIT_KEYBOARD = yes' in your rules.mk, and define SOFT_SERIAL_PIN.
- */
-#define SOFT_SERIAL_PIN D0  // or D1, D2, D3, E6
-
-//#define LED_NUM_LOCK_PIN B0
-//#define LED_CAPS_LOCK_PIN B1
-//#define LED_SCROLL_LOCK_PIN B2
-//#define LED_COMPOSE_PIN B3
-//#define LED_KANA_PIN B4
-
-//#define BACKLIGHT_PIN B7
-//#define BACKLIGHT_LEVELS 3
-//#define BACKLIGHT_BREATHING
-
-//#define RGB_DI_PIN E2
-//#ifdef RGB_DI_PIN
-//#    define RGBLED_NUM 16
-//#    define RGBLIGHT_HUE_STEP 8
-//#    define RGBLIGHT_SAT_STEP 8
-//#    define RGBLIGHT_VAL_STEP 8
-//#    define RGBLIGHT_LIMIT_VAL 255 /* The maximum brightness level */
-//#    define RGBLIGHT_SLEEP  /* If defined, the RGB lighting will be switched off when the host goes to sleep */
-/*== all animations enable ==*/
-//#    define RGBLIGHT_ANIMATIONS
-/*== or choose animations ==*/
-//#    define RGBLIGHT_EFFECT_BREATHING
-//#    define RGBLIGHT_EFFECT_RAINBOW_MOOD
-//#    define RGBLIGHT_EFFECT_RAINBOW_SWIRL
-//#    define RGBLIGHT_EFFECT_SNAKE
-//#    define RGBLIGHT_EFFECT_KNIGHT
-//#    define RGBLIGHT_EFFECT_CHRISTMAS
-//#    define RGBLIGHT_EFFECT_STATIC_GRADIENT
-//#    define RGBLIGHT_EFFECT_RGB_TEST
-//#    define RGBLIGHT_EFFECT_ALTERNATING
-/*== customize breathing effect ==*/
-/*==== (DEFAULT) use fixed table instead of exp() and sin() ====*/
-//#    define RGBLIGHT_BREATHE_TABLE_SIZE 256      // 256(default) or 128 or 64
-/*==== use exp() and sin() ====*/
-//#    define RGBLIGHT_EFFECT_BREATHE_CENTER 1.85  // 1 to 2.7
-//#    define RGBLIGHT_EFFECT_BREATHE_MAX    255   // 0 to 255
-//#endif
-
-/* Debounce reduces chatter (unintended double-presses) - set 0 if debouncing is not needed */
-#define DEBOUNCE 5
-
-/* define if matrix has ghost (lacks anti-ghosting diodes) */
-//#define MATRIX_HAS_GHOST
-
-/* Mechanical locking support. Use KC_LCAP, KC_LNUM or KC_LSCR instead in keymap */
-#define LOCKING_SUPPORT_ENABLE
-/* Locking resynchronize hack */
-#define LOCKING_RESYNC_ENABLE
-
-/* If defined, GRAVE_ESC will always act as ESC when CTRL is held.
- * This is useful for the Windows task manager shortcut (ctrl+shift+esc).
- */
-//#define GRAVE_ESC_CTRL_OVERRIDE
-
-/*
- * Force NKRO
- *
- * Force NKRO (nKey Rollover) to be enabled by default, regardless of the saved
- * state in the bootmagic EEPROM settings. (Note that NKRO must be enabled in the
- * makefile for this to work.)
- *
- * If forced on, NKRO can be disabled via magic key (default = LShift+RShift+N)
- * until the next keyboard reset.
- *
- * NKRO may prevent your keystrokes from being detected in the BIOS, but it is
- * fully operational during normal computer usage.
- *
- * For a less heavy-handed approach, enable NKRO via magic key (LShift+RShift+N)
- * or via bootmagic (hold SPACE+N while plugging in the keyboard). Once set by
- * bootmagic, NKRO mode will always be enabled until it is toggled again during a
- * power-up.
- *
- */
-//#define FORCE_NKRO
-
-/*
- * Feature disable options
- *  These options are also useful to firmware size reduction.
- */
-
-/* disable debug print */
-//#define NO_DEBUG
-
-/* disable print */
-//#define NO_PRINT
-
-/* disable action features */
-//#define NO_ACTION_LAYER
-//#define NO_ACTION_TAPPING
-//#define NO_ACTION_ONESHOT
-
-/* disable these deprecated features by default */
-#define NO_ACTION_MACRO
-#define NO_ACTION_FUNCTION
-
-/* Bootmagic Lite key configuration */
-#define BOOTMAGIC_LITE_ROW 4
-#define BOOTMAGIC_LITE_COLUMN 0
-
-
-#define VIAL_KEYBOARD_UID {0xE1, 0x03, 0xDC, 0xC8, 0xB3, 0x98, 0x04, 0x18}
-// top 2 keys of right most column
-#define VIAL_UNLOCK_COMBO_ROWS {0,1}
-#define VIAL_UNLOCK_COMBO_COLS {4,4}
-
-#define VIAL_ENCODER_DEFAULT { KC_VOLD, KC_VOLU, KC_BRID, KC_BRIU, KC_TRNS, KC_TRNS, KC_TRNS, KC_TRNS }
-
-
-
-
-
-
-
-
diff --git a/keyboards/monenumpad/info.json b/keyboards/monenumpad/info.json
deleted file mode 100644
index 6dcde0e1d0..0000000000
--- a/keyboards/monenumpad/info.json
+++ /dev/null
@@ -1,29 +0,0 @@
-/*
-   * 
-   * Coordination (x,y)
-   * ,--------------------------------- .
-   * |          |  $  |  %  |  /  |  *  |
-   * |----------|-----|-----|-----|-----|
-   * |          |  7  |  8  |  9  |  -  |
-   * |----------|-----|-----|-----|-----|
-   * |          |  4  |  5  |  6  |  +  |
-   * |----------|-----|-----|-----|-----|
-   * |   Mute   |  1  |  2  |  3  | Ent |
-   * |          |     |     |     |     |
-   * |----------|-----------|-----|     |
-   * |   Bksp   |  0        |   . |     |
-   * `----------------------------------'
-*/
-{
- "keyboard_name": "monenumpad",
- "url": "",
- "maintainer": "monehsieh",
-    "layouts": {
-        "LAYOUT": {
-            "layout": [{"label":"0,1", "x":1.75, "y":0}, {"label":"0,2", "x":2.75, "y":0}, {"label":"0,3", "x":3.75, "y":0}, {"label":"0,4", "x":4.75, "y":0}, {"label":"1,1", "x":1.75, "y":1}, {"label":"1,2", "x":2.75, "y":1}, {"label":"1,3", "x":3.75, "y":1}, {"label":"1,4", "x":4.75, "y":1}, {"label":"2,1", "x":1.75, "y":2}, {"label":"2,2", "x":2.75, "y":2}, {"label":"2,3", "x":3.75, "y":2}, {"label":"2,4", "x":4.75, "y":2}, {"label":"3,0", "x":0.75, "y":3}, {"label":"3,1", "x":1.75, "y":3}, {"label":"3,2", "x":2.75, "y":3}, {"label":"3,3", "x":3.75, "y":3}, {"label":"4,4", "x":4.75, "y":3, "h":2}, {"label":"4,0", "x":0.75, "y":4}, {"label":"4,2", "x":1.75, "y":4, "w":2}, {"label":"4,3", "x":3.75, "y":4}]
-        }
-    }
-}
-
-
-
diff --git a/keyboards/monenumpad/keymaps/default/keymap.c b/keyboards/monenumpad/keymaps/default/keymap.c
deleted file mode 100644
index 8a97f6acd4..0000000000
--- a/keyboards/monenumpad/keymaps/default/keymap.c
+++ /dev/null
@@ -1,84 +0,0 @@
-// Copyright 2022 monehsieh (@monehsieh)
-// SPDX-License-Identifier: GPL-2.0-or-later
-
-#include QMK_KEYBOARD_H
-
-// Defines names for use in layer keycodes and the keymap
-enum layer_names {
-    _BASE,
-    _FN
-};
-
-/*
-#define LAYOUT( \
-         K01, K02, K03, K04, \
-         K11, K12, K13, K14, \
-         K21, K22, K23, K24, \
-    K30, K31, K32, K33,      \
-    K40,      K42, K43, K44  \
-) { \
-
-*/
-
-const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
-    /* Base */
-    [_BASE] = LAYOUT(
-         KC_DLR, KC_PERC, KC_PSLS, KC_PAST, 
-         KC_P7,  KC_P8,   KC_P9,   KC_PMNS, 
-         KC_P4,  KC_P5,   KC_P6,   KC_PPLS, 
-KC_MUTE, KC_P1,  KC_P2,   KC_P3, 
-KC_BSPACE,       KC_P0,   KC_DOT,  KC_PENT),
-
-    [_FN] = LAYOUT(
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
- _______, _______, _______, _______,  
- _______,          _______, _______, _______)
-};
-
-
-bool encoder_update_user(uint8_t index, bool clockwise) 
-{
-    const layer_state_t curr_layer = get_highest_layer(layer_state);
-
-#ifdef CONSOLE_ENABLE
-    uprintf("KL: encoder: index: %u, clockwise: %u\n", index, (int)clockwise);
-#endif
-
-    if(curr_layer == 1) {
-        if (clockwise) {
-            tap_code(KC_BRIU);
-        } else {
-            tap_code(KC_BRID);
-        }
-    }
-    else  {
-        if (clockwise) {
-            tap_code(KC_VOLU);
-        } else {
-            tap_code(KC_VOLD);
-        }
-    }
-    return false;
-}
-
-
-void keyboard_post_init_user(void) {
-  // Customise these values to desired behaviour
-  debug_enable=true;
-  debug_matrix=true;
-  //debug_keyboard=true;
-  //debug_mouse=true;
-}
-
-
-bool process_record_user(uint16_t keycode, keyrecord_t *record) {
-  // If console is enabled, it will print the matrix position and status of each key pressed
-#ifdef CONSOLE_ENABLE
-    uprintf("KL: kc: 0x%04X, col: %u, row: %u, pressed: %b, time: %u, interrupt: %b, count: %u\n", keycode, record->event.key.col, record->event.key.row, record->event.pressed, record->event.time, record->tap.interrupted, record->tap.count);
-#endif 
-  return true;
-}
-
-
diff --git a/keyboards/monenumpad/keymaps/vial/keymap.c b/keyboards/monenumpad/keymaps/vial/keymap.c
deleted file mode 100644
index a0cfb776d1..0000000000
--- a/keyboards/monenumpad/keymaps/vial/keymap.c
+++ /dev/null
@@ -1,102 +0,0 @@
-// Copyright 2022 monehsieh (@monehsieh)
-// SPDX-License-Identifier: GPL-2.0-or-later
-
-#include QMK_KEYBOARD_H
-
-// Defines names for use in layer keycodes and the keymap
-enum layer_names {
-    _BASE,
-    _FN1,
-    _FN2,
-    _FN3
-};
-
-/*
-#define LAYOUT( \
-         K01, K02, K03, K04, \
-         K11, K12, K13, K14, \
-         K21, K22, K23, K24, \
-    K30, K31, K32, K33, \
-    K40,   K42,    K43, K44  \
-) { \
-
-*/
-
-const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
-    /* Base */
-    [_BASE] = LAYOUT(
-         KC_DLR, KC_PERC, KC_PSLS, KC_PAST, 
-         KC_P7,  KC_P8,   KC_P9,   KC_PMNS, 
-         KC_P4,  KC_P5,   KC_P6,   KC_PPLS, 
-KC_MUTE, KC_P1,  KC_P2,   KC_P3, 
-KC_BSPACE,    KC_P0   ,   KC_DOT,  KC_PENT),
-
-    [_FN1] = LAYOUT(
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
- _______, _______, _______, _______,  
- _______,     _______     , _______, _______),
-
-
-    [_FN2] = LAYOUT(
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
- _______, _______, _______, _______,  
- _______,     _______     , _______, _______),
-
-    [_FN3] = LAYOUT(
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
-          _______, _______, _______, _______, 
- _______, _______, _______, _______,  
- _______,     _______     , _______, _______)
-
-};
-
-
-bool encoder_update_user(uint8_t index, bool clockwise) 
-{
-    const layer_state_t curr_layer = get_highest_layer(layer_state);
-
-#ifdef CONSOLE_ENABLE
-    uprintf("KL: encoder: index: %u, clockwise: %u\n", index, (int)clockwise);
-#endif
-
-    if(curr_layer == 1) {
-        if (clockwise) {
-            tap_code(KC_BRIU);
-        } else {
-            tap_code(KC_BRID);
-        }
-    }
-    else  {
-        if (clockwise) {
-            tap_code(KC_VOLU);
-        } else {
-            tap_code(KC_VOLD);
-        }
-    }
-    return false;
-}
-
-
-void keyboard_post_init_user(void) {
-  // Customise these values to desired behaviour
-  debug_enable=true;
-  debug_matrix=true;
-  //debug_keyboard=true;
-  //debug_mouse=true;
-}
-
-
-bool process_record_user(uint16_t keycode, keyrecord_t *record) {
-  // If console is enabled, it will print the matrix position and status of each key pressed
-#ifdef CONSOLE_ENABLE
-    uprintf("KL: kc: 0x%04X, col: %u, row: %u, pressed: %b, time: %u, interrupt: %b, count: %u\n", keycode, record->event.key.col, record->event.key.row, record->event.pressed, record->event.time, record->tap.interrupted, record->tap.count);
-#endif 
-  return true;
-}
-
-
diff --git a/keyboards/monenumpad/keymaps/vial/rules.mk b/keyboards/monenumpad/keymaps/vial/rules.mk
deleted file mode 100644
index 83e6e1d80c..0000000000
--- a/keyboards/monenumpad/keymaps/vial/rules.mk
+++ /dev/null
@@ -1,8 +0,0 @@
-VIA_ENABLE = yes
-VIAL_ENABLE = yes
-VIAL_ENCODERS_ENABLE = yes
-
-# LTO makes the compiler work harder when optimizing your code, resulting in a smaller firmware size
-#LTO_ENABLE = yes
-
-QMK_SETTINGS = no
diff --git a/keyboards/monenumpad/keymaps/vial/vial.json b/keyboards/monenumpad/keymaps/vial/vial.json
deleted file mode 100644
index 44fc43560b..0000000000
--- a/keyboards/monenumpad/keymaps/vial/vial.json
+++ /dev/null
@@ -1,99 +0,0 @@
-{
-    "name": "monenumpad",
-    "vendorId": "0x6D68",
-    "productId": "0x0001",
-    "lighting": "none",
-    "matrix": {
-        "rows": 5,
-        "cols": 5
-    },
-    "layouts": {
-        "keymap": [
-
-  [
-    {
-      "x": 1.75
-    },
-    "0,1",
-    "0,2",
-    "0,3",
-    {
-      "x": -0.5,
-      "a": 7,
-      "f": 4,
-      "w": 14,
-      "h": 5,
-      "d": true
-    },
-    "",
-    {
-      "x": -13.5,
-      "a": 4,
-      "f": 3
-    },
-    "0,4"
-  ],
-  [
-    {
-      "x": 1.75
-    },
-    "1,1",
-    "1,2",
-    "1,3",
-    "1,4"
-  ],
-  [
-    {
-      "x": 1.75
-    },
-    "2,1",
-    "2,2",
-    "2,3",
-    "2,4"
-  ],
-  [
-    "3,0",
-    {
-      "f": 2,
-      "w": 0.75,
-      "h": 0.75
-    },
-    "0,0\n\n\n\n\n\n\n\n\ne",
-    {
-      "f": 3
-    },
-    "3,1",
-    "3,2",
-    "3,3",
-    {
-      "h": 2
-    },
-    "4,4"
-  ],
-  [
-    {
-      "y": -0.25,
-      "x": 1,
-      "f": 2,
-      "w": 0.75,
-      "h": 0.75
-    },
-    "0,1\n\n\n\n\n\n\n\n\ne"
-  ],
-  [
-    {
-      "y": -0.75,
-      "f": 3
-    },
-    "4,0",
-    {
-      "x": 0.75,
-      "w": 2
-    },
-    "4,2",
-    "4,3"
-  ]
-
-        ]
-    }
-}
diff --git a/keyboards/monenumpad/monenumpad.c b/keyboards/monenumpad/monenumpad.c
deleted file mode 100644
index 2104872cdf..0000000000
--- a/keyboards/monenumpad/monenumpad.c
+++ /dev/null
@@ -1,4 +0,0 @@
-// Copyright 2022 monehsieh (@monehsieh)
-// SPDX-License-Identifier: GPL-2.0-or-later
-
-#include "monenumpad.h"
diff --git a/keyboards/monenumpad/monenumpad.h b/keyboards/monenumpad/monenumpad.h
deleted file mode 100644
index 46bf091725..0000000000
--- a/keyboards/monenumpad/monenumpad.h
+++ /dev/null
@@ -1,55 +0,0 @@
-// Copyright 2022 monehsieh (@monehsieh)
-// SPDX-License-Identifier: GPL-2.0-or-later
-
-#pragma once
-
-#include "quantum.h"
-
-/* This is a shortcut to help you visually see your layout.
- *
- * The first section contains all of the arguments representing the physical
- * layout of the board and position of the keys.
- *
- * The second converts the arguments into a two-dimensional array which
- * represents the switch matrix.
- */
-
-/*
-#define LAYOUT( \
-    k00, k01, k02, \
-      k10,  k12    \
-) { \
-    { k00, k01,   k02 }, \
-    { k10, KC_NO, k12 }  \
-}
-*/
-
-/* Mone numpad matrix layout
-   * ,----------------------- .
-   * |    | 01 | 02 | 03 | 04 |
-   * |----|----|----|----|----|
-   * |    | 11 | 12 | 13 | 14 |
-   * |----|----|----|----|----|
-   * |    | 21 | 22 | 23 | 24 |
-   * |----|----|----|----|----|
-   * | 30 | 31 | 32 | 33 |    |
-   * |----|---------|----| 44 |
-   * | 40 |   42    | 43 |    |
-   * `------------------------'
- */
-
-
-#define LAYOUT( \
-         K01, K02, K03, K04, \
-         K11, K12, K13, K14, \
-         K21, K22, K23, K24, \
-    K30, K31, K32, K33, \
-    K40,      K42, K43, K44  \
-) { \
-    { KC_NO, K01,   K02,   K03,   K04 }, \
-    { KC_NO, K11,   K12,   K13,   K14 }, \
-    { KC_NO, K21,   K22,   K23,   K24 }, \
-    { K30,   K31,   K32,   K33,   KC_NO }, \
-    { K40,   KC_NO, K42,   K43,   K44 }  \
-}
-
diff --git a/keyboards/monenumpad/monenumpad.json b/keyboards/monenumpad/monenumpad.json
deleted file mode 100644
index 560c16725b..0000000000
--- a/keyboards/monenumpad/monenumpad.json
+++ /dev/null
@@ -1,60 +0,0 @@
-[
-  {
-    "name": "monenumpad",
-    "author": "monehsieh"
-  },
-  [
-    {
-      "x": 1
-    },
-    "$",
-    "%",
-    "/",
-    "*",
-    {
-      "x": -0.75,
-      "f": 4,
-      "w": 14,
-      "h": 5,
-      "d": true
-    },
-    "<h5><b>Getting Started with Keyboard-Layout-Editor.com</b></h5><p>Keyboard-layout-editor.com is a web application that enables the editing of keyboard-layouts, i.e., the position and appearance of each physical key.</p><p>Start by exploring the presets and samples from the menu-bar to give you an idea of the possibilities.  Once you are ready to start designing your own keyboard, just load one of the presets and start customizing it!  Some tips:</p><ul><li>The selected keys can be modified on the <i>Properties</i> tab.</li><li>The <i>Keyboard Properties</i> tab lets you edit the keyboard background and keyboard metadata.</li><li>The <i>Custom Styles</i> tab lets you write advanced CSS styling rules.</li><li>Don't forget the <i>Color Swatches</i> and <i>Character Picker</i> menu items!  These give you easy access to colors and symbol characters, respectively.</li><li>There are a lot of available keyboard shortcuts; press '?' or 'F1' to see a list.</li></ul><p>When you're ready to save your layout, simply 'Sign In' with your <a href='https://www.github.com'>GitHub</a> account and click the <i>Save</i> button.  Your layout will be saved in a GitHub Gist.</p><p>Have fun!</p>"
-  ],
-  [
-    {
-      "x": 1,
-      "f": 3
-    },
-    "7",
-    "8",
-    "9",
-    "-"
-  ],
-  [
-    "Mute",
-    "4",
-    "5",
-    "6",
-    "+"
-  ],
-  [
-    {
-      "x": 1
-    },
-    "1",
-    "2",
-    "3",
-    {
-      "h": 2
-    },
-    "Enter"
-  ],
-  [
-    "Del",
-    {
-      "w": 2
-    },
-    "0",
-    "."
-  ]
-]
\ No newline at end of file
diff --git a/keyboards/monenumpad/readme.md b/keyboards/monenumpad/readme.md
deleted file mode 100644
index 84afe81a56..0000000000
--- a/keyboards/monenumpad/readme.md
+++ /dev/null
@@ -1,37 +0,0 @@
-# monenumpad
-
-![monenumpad](imgur.com image replace me!)
-
-*A short description of the keyboard/project*
-
-* Keyboard Maintainer: [monehsieh](https://github.com/monehsieh)
-* Hardware Supported: *The PCBs, controllers supported*
-* Hardware Availability: *Links to where you can find this hardware*
-
-Install qmk
-
-    git clone https://github.com/vial-kb/vial-qmk.git
-
-Make example for this keyboard (after setting up your build environment):
-
-    make monenumpad:vial
-
-Flashing example for this keyboard:
-
-    make monenumpad:vial:flash
-
-See the [build environment setup](https://docs.qmk.fm/#/getting_started_build_tools) and the [make instructions](https://docs.qmk.fm/#/getting_started_make_guide) for more information. Brand new to QMK? Start with our [Complete Newbs Guide](https://docs.qmk.fm/#/newbs).
-
-
-See [VIAL Porting Build](https://get.vial.today/docs/)
-
-
-## Bootloader
-
-Enter the bootloader in one of the following ways:
-
-* **Physical reset button**: Briefly press the button on the back of the PCB - some may have pads you must short instead
-* **Ground reset pin**: Short GND and RESET pin on the micro controller
-
-
-
diff --git a/keyboards/monenumpad/rules.mk b/keyboards/monenumpad/rules.mk
deleted file mode 100644
index 1c7011c38e..0000000000
--- a/keyboards/monenumpad/rules.mk
+++ /dev/null
@@ -1,27 +0,0 @@
-# MCU name
-MCU = atmega32u4
-
-# Bootloader selection
-BOOTLOADER = atmel-dfu
-
-# Build Options
-#   change yes to no to disable
-#
-BOOTMAGIC_ENABLE = yes      # Enable Bootmagic Lite
-MOUSEKEY_ENABLE = yes       # Mouse keys
-EXTRAKEY_ENABLE = yes       # Audio control and System control
-CONSOLE_ENABLE = yes         # Console for debug
-COMMAND_ENABLE = no         # Commands for debug and configuration
-NKRO_ENABLE = no            # Enable N-Key Rollover
-BACKLIGHT_ENABLE = no       # Enable keyboard backlight functionality
-RGBLIGHT_ENABLE = no        # Enable keyboard RGB underglow
-AUDIO_ENABLE = no           # Audio output
-
-ENCODER_ENABLE = yes
-
-
-VIA_ENABLE = yes
-VIAL_ENABLE = yes
-VIAL_ENCODERS_ENABLE = yes
-
-
diff --git a/quantum/action.c b/quantum/action.c
index 0f9ea2120a..03e0769687 100644
--- a/quantum/action.c
+++ b/quantum/action.c
@@ -290,6 +290,18 @@ void process_action(keyrecord_t *record, action_t action) {
 
     switch (action.kind.id) {
         /* Key and Mods */
+
+#ifdef APPLE_FN_ENABLE
+        /* Apple Fn */
+        case ACT_APPLE_FN:
+            if (event.pressed) {
+                register_code(KC_APPLE_FN);
+            } else {
+                unregister_code(KC_APPLE_FN);
+            }
+            break;
+#endif
+
         case ACT_LMODS:
         case ACT_RMODS: {
             uint8_t mods = (action.kind.id == ACT_LMODS) ? action.key.mods : action.key.mods << 4;
@@ -873,6 +885,12 @@ __attribute__((weak)) void register_code(uint8_t code) {
         host_consumer_send(KEYCODE2CONSUMER(code));
     }
 #endif
+#ifdef APPLE_FN_ENABLE
+    else if IS_APPLE_FN (code) {
+        add_key(code);
+        send_keyboard_report();
+    }
+#endif    
 #ifdef MOUSEKEY_ENABLE
     else if IS_MOUSEKEY (code) {
         mousekey_on(code);
@@ -933,6 +951,12 @@ __attribute__((weak)) void unregister_code(uint8_t code) {
     } else if IS_CONSUMER (code) {
         host_consumer_send(0);
     }
+#ifdef APPLE_FN_ENABLE
+    else if IS_APPLE_FN (code) {
+        del_key(code);
+        send_keyboard_report();
+    }
+#endif
 #ifdef MOUSEKEY_ENABLE
     else if IS_MOUSEKEY (code) {
         mousekey_off(code);
@@ -1139,6 +1163,9 @@ void debug_action(action_t action) {
         case ACT_USAGE:
             dprint("ACT_USAGE");
             break;
+        case ACT_APPLE_FN:
+            dprint("ACT_APPLE_FN");
+            break;
         case ACT_MOUSEKEY:
             dprint("ACT_MOUSEKEY");
             break;
diff --git a/quantum/action_code.h b/quantum/action_code.h
index 20b3e459d2..33968ac314 100644
--- a/quantum/action_code.h
+++ b/quantum/action_code.h
@@ -51,6 +51,9 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  * ACT_SWAP_HANDS(0110):
  * 0110|xxxx| keycode     Swap hands (keycode on tap, or options)
  *
+ * ACT_APPLE_FN(0111):
+ * 0111|0000|0000|0000    Apple Fn
+ * 
  * 0111|xxxx xxxx xxxx    (reserved)
  *
  * Layer Actions(10xx)
@@ -93,6 +96,8 @@ enum action_kind_id {
     ACT_MOUSEKEY = 0b0101,
     /* One-hand Support */
     ACT_SWAP_HANDS = 0b0110,
+    /* Apple Fn */
+    ACT_APPLE_FN = 0b0111,
     /* Layer Actions */
     ACT_LAYER         = 0b1000,
     ACT_LAYER_MODS    = 0b1001,
@@ -195,6 +200,7 @@ enum mods_codes {
 enum usage_pages { PAGE_SYSTEM, PAGE_CONSUMER };
 #define ACTION_USAGE_SYSTEM(id) ACTION(ACT_USAGE, PAGE_SYSTEM << 10 | (id))
 #define ACTION_USAGE_CONSUMER(id) ACTION(ACT_USAGE, PAGE_CONSUMER << 10 | (id))
+#define ACTION_APPLE_FN() ACTION(ACT_APPLE_FN, 0)
 #define ACTION_MOUSEKEY(key) ACTION(ACT_MOUSEKEY, key)
 
 /** \brief Layer Actions
diff --git a/quantum/keycode.h b/quantum/keycode.h
index 3c80a386d1..a8ce63af64 100644
--- a/quantum/keycode.h
+++ b/quantum/keycode.h
@@ -34,6 +34,7 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.
 #define IS_SPECIAL(code) ((0xA5 <= (code) && (code) <= 0xDF) || (0xE8 <= (code) && (code) <= 0xFF))
 #define IS_SYSTEM(code) (KC_PWR <= (code) && (code) <= KC_WAKE)
 #define IS_CONSUMER(code) (KC_MUTE <= (code) && (code) <= KC_BRID)
+#define IS_APPLE_FN(code) (KC_APFN == (code))
 
 #define IS_MOUSEKEY(code) (KC_MS_UP <= (code) && (code) <= KC_MS_ACCEL2)
 #define IS_MOUSEKEY_MOVE(code) (KC_MS_UP <= (code) && (code) <= KC_MS_RIGHT)
@@ -206,6 +207,9 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.
 #define KC_BRIU KC_BRIGHTNESS_UP
 #define KC_BRID KC_BRIGHTNESS_DOWN
 
+/* Apple Fn */
+#define KC_APFN KC_APPLE_FN
+
 /* System Specific */
 #define KC_BRMU KC_PAUSE
 #define KC_BRMD KC_SCROLL_LOCK
@@ -502,7 +506,10 @@ enum internal_special_keycodes {
     KC_MEDIA_FAST_FORWARD,
     KC_MEDIA_REWIND,
     KC_BRIGHTNESS_UP,
-    KC_BRIGHTNESS_DOWN
+    KC_BRIGHTNESS_DOWN,
+
+    /* Apple Fn */
+    KC_APPLE_FN
 };
 
 enum mouse_keys {
diff --git a/quantum/keymap_common.c b/quantum/keymap_common.c
index a91b2a0b36..da752e94a1 100644
--- a/quantum/keymap_common.c
+++ b/quantum/keymap_common.c
@@ -66,6 +66,11 @@ action_t action_for_keycode(uint16_t keycode) {
             action.code = ACTION_USAGE_CONSUMER(KEYCODE2CONSUMER(keycode));
             break;
 #endif
+#ifdef APPLE_FN_ENABLE
+        case KC_APPLE_FN:
+            action.code = ACTION_APPLE_FN();
+            break;
+#endif            
 #ifdef MOUSEKEY_ENABLE
         case KC_MS_UP ... KC_MS_ACCEL2:
             action.code = ACTION_MOUSEKEY(keycode);
diff --git a/tmk_core/protocol/report.c b/tmk_core/protocol/report.c
index 854b59ae48..ed9659f56d 100644
--- a/tmk_core/protocol/report.c
+++ b/tmk_core/protocol/report.c
@@ -241,6 +241,12 @@ void del_key_bit(report_keyboard_t* keyboard_report, uint8_t code) {
  * FIXME: Needs doc
  */
 void add_key_to_report(report_keyboard_t* keyboard_report, uint8_t key) {
+#ifdef APPLE_FN_ENABLE
+    if IS_APPLE_FN(key) {
+        keyboard_report->reserved = 1;
+        return;
+    }
+#endif
 #ifdef NKRO_ENABLE
     if (keyboard_protocol && keymap_config.nkro) {
         add_key_bit(keyboard_report, key);
@@ -255,6 +261,12 @@ void add_key_to_report(report_keyboard_t* keyboard_report, uint8_t key) {
  * FIXME: Needs doc
  */
 void del_key_from_report(report_keyboard_t* keyboard_report, uint8_t key) {
+#ifdef APPLE_FN_ENABLE
+    if IS_APPLE_FN(key) {
+        keyboard_report->reserved = 0;
+        return;
+    }
+#endif
 #ifdef NKRO_ENABLE
     if (keyboard_protocol && keymap_config.nkro) {
         del_key_bit(keyboard_report, key);
diff --git a/tmk_core/protocol/usb_descriptor.c b/tmk_core/protocol/usb_descriptor.c
index 656b75d7f5..be5c6eaffb 100644
--- a/tmk_core/protocol/usb_descriptor.c
+++ b/tmk_core/protocol/usb_descriptor.c
@@ -71,10 +71,20 @@ const USB_Descriptor_HIDReport_Datatype_t PROGMEM KeyboardReport[] = {
         HID_RI_REPORT_COUNT(8, 0x08),
         HID_RI_REPORT_SIZE(8, 0x01),
         HID_RI_INPUT(8, HID_IOF_DATA | HID_IOF_VARIABLE | HID_IOF_ABSOLUTE),
+#ifdef APPLE_FN_ENABLE
+        HID_RI_USAGE_PAGE(8, 0xFF),    // AppleVendor Top Case
+        HID_RI_USAGE(8, 0x03),         // KeyboardFn
+        HID_RI_LOGICAL_MINIMUM(8, 0x00),
+        HID_RI_LOGICAL_MAXIMUM(8, 0x01),
+        HID_RI_REPORT_COUNT(8, 0x01),
+        HID_RI_REPORT_SIZE(8, 0x08),
+        HID_RI_INPUT(8, HID_IOF_DATA | HID_IOF_VARIABLE | HID_IOF_ABSOLUTE),
+#else        
         // Reserved (1 byte)
         HID_RI_REPORT_COUNT(8, 0x01),
         HID_RI_REPORT_SIZE(8, 0x08),
         HID_RI_INPUT(8, HID_IOF_CONSTANT),
+#endif        
         // Keycodes (6 bytes)
         HID_RI_USAGE_PAGE(8, 0x07),    // Keyboard/Keypad
         HID_RI_USAGE_MINIMUM(8, 0x00),
diff --git a/tmk_core/protocol/vusb/vusb.c b/tmk_core/protocol/vusb/vusb.c
index ebde955d3b..1adbaeaa03 100644
--- a/tmk_core/protocol/vusb/vusb.c
+++ b/tmk_core/protocol/vusb/vusb.c
@@ -429,10 +429,19 @@ const PROGMEM uchar keyboard_hid_report[] = {
     0x95, 0x08, //   Report Count (8)
     0x75, 0x01, //   Report Size (1)
     0x81, 0x02, //   Input (Data, Variable, Absolute)
-    // Reserved (1 byte)
+#ifdef APPLE_FN_ENABLE
+    0x05, 0xFF,  //   Usage Page (AppleVendor Top Case)
+    0x09, 0x03,  //   Usage (KeyboardFn)
+    0x15, 0x00,  //   Logical Minimum (0)
+    0x25, 0x01,  //   Logical Maximum (1)
+    0x95, 0x01,  //   Report Count (1)
+    0x75, 0x08,  //   Report Size (8)
+    0x81, 0x02,  //   Input (Data, Variable, Absolute)
+#else    // Reserved (1 byte)
     0x95, 0x01, //   Report Count (1)
     0x75, 0x08, //   Report Size (8)
     0x81, 0x03, //   Input (Constant)
+#endif    
     // Keycodes (6 bytes)
     0x05, 0x07,       //   Usage Page (Keyboard/Keypad)
     0x19, 0x00,       //   Usage Minimum (0)
-- 
2.31.0

From 92d6a8949050d28a0287b8d20fabc78c3fc22b6f Mon Sep 17 00:00:00 2001
From: monehsieh <monehsieh@gmail.com>
Date: Thu, 24 Mar 2022 09:32:16 -0700
Subject: [PATCH] 1. intercepted encoder_update_kb to mone_encoder_update to
 allow us to override the encoder's behaviour.

---
 quantum/encoder.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/quantum/encoder.c b/quantum/encoder.c
index c0c1be52d3..26f73cc6de 100644
--- a/quantum/encoder.c
+++ b/quantum/encoder.c
@@ -73,7 +73,15 @@ __attribute__((weak)) bool encoder_update_kb(uint8_t index, bool clockwise) {
 
 #ifdef VIAL_ENCODERS_ENABLE
 #include "vial.h"
-#define encoder_update_kb vial_encoder_update
+    #ifdef MONE_ENCODERS_ENABLE
+        #define encoder_update_kb mone_encoder_update
+
+        __attribute__((weak)) bool mone_encoder_update(uint8_t index, bool clockwise) {
+            return vial_encoder_update(index, clockwise);
+        }
+    #else
+        #define encoder_update_kb vial_encoder_update
+    #endif
 #endif
 
 void encoder_init(void) {
-- 
2.31.0

From 77aaff57625dc2bab3a5bb84661d3d3f5a5efcd2 Mon Sep 17 00:00:00 2001
From: monehsieh <monehsieh@gmail.com>
Date: Wed, 13 Apr 2022 23:45:39 -0700
Subject: [PATCH] Added support to handle my own HID commands: id_mone_prefix =
 0xFD

Other changes:
1. renamed MONE_ENCODERS_ENABLE to VIAL_MONE_ENCODERS_ENABLE to make it clear that MONE_ENCODERS_ENABLE depends on Vial's encoder support.

2. refactored the logic to obtain the keycode to trigger inside vial_encoder_update() to another function vial_get_encoder_keycode(), so my keyboard can use that to decide if it should perform the default behaviour.
---
 quantum/encoder.c |  2 +-
 quantum/via.h     |  3 +++
 quantum/vial.c    | 16 +++++++++++-----
 quantum/vial.h    |  1 +
 4 files changed, 16 insertions(+), 6 deletions(-)

diff --git a/quantum/encoder.c b/quantum/encoder.c
index 26f73cc6de..8382bb9f8d 100644
--- a/quantum/encoder.c
+++ b/quantum/encoder.c
@@ -73,7 +73,7 @@ __attribute__((weak)) bool encoder_update_kb(uint8_t index, bool clockwise) {
 
 #ifdef VIAL_ENCODERS_ENABLE
 #include "vial.h"
-    #ifdef MONE_ENCODERS_ENABLE
+    #ifdef VIAL_MONE_ENCODERS_ENABLE
         #define encoder_update_kb mone_encoder_update
 
         __attribute__((weak)) bool mone_encoder_update(uint8_t index, bool clockwise) {
diff --git a/quantum/via.h b/quantum/via.h
index 13ed227388..7444750ed0 100644
--- a/quantum/via.h
+++ b/quantum/via.h
@@ -78,6 +78,9 @@ enum via_command_id {
     id_dynamic_keymap_get_layer_count       = 0x11,
     id_dynamic_keymap_get_buffer            = 0x12,
     id_dynamic_keymap_set_buffer            = 0x13,
+#ifdef MONE_HID_ENABLE
+    id_mone_prefix                          = 0xFD,
+#endif
     id_vial_prefix                          = 0xFE,
     id_unhandled                            = 0xFF,
 };
diff --git a/quantum/vial.c b/quantum/vial.c
index da2ce56b10..237ae3dd05 100644
--- a/quantum/vial.c
+++ b/quantum/vial.c
@@ -303,6 +303,14 @@ static void exec_keycode(uint16_t keycode) {
 }
 
 bool vial_encoder_update(uint8_t index, bool clockwise) {
+    uint16_t code = vial_get_encoder_keycode(index, clockwise);
+    exec_keycode(code);
+    return true;
+}
+
+// Mone: refactor code to get encoder keycode out to a separate function
+uint16_t vial_get_encoder_keycode(uint8_t index, bool clockwise) 
+{
     uint16_t code;
 
     layer_state_t layers = layer_state | default_layer_state;
@@ -311,17 +319,15 @@ bool vial_encoder_update(uint8_t index, bool clockwise) {
         if (layers & (1UL << i)) {
             code = dynamic_keymap_get_encoder(i, index, clockwise);
             if (code != KC_TRNS) {
-                exec_keycode(code);
-                return true;
+                return code;
             }
         }
     }
     /* fall back to layer 0 */
     code = dynamic_keymap_get_encoder(0, index, clockwise);
-    exec_keycode(code);
-
-    return true;
+    return code;
 }
+
 #endif
 
 #ifdef VIAL_TAP_DANCE_ENABLE
diff --git a/quantum/vial.h b/quantum/vial.h
index 85d297848b..41a80fec2c 100644
--- a/quantum/vial.h
+++ b/quantum/vial.h
@@ -31,6 +31,7 @@ bool process_record_vial(uint16_t keycode, keyrecord_t *record);
 
 #ifdef VIAL_ENCODERS_ENABLE
 bool vial_encoder_update(uint8_t index, bool clockwise);
+uint16_t vial_get_encoder_keycode(uint8_t index, bool clockwise);
 #endif
 
 extern int vial_unlocked;
-- 
2.31.0

